---
resource_types:
  - name: artifactory
    type: docker-image
    source:
      repository: pivotalservices/artifactory-resource
  - name: discord-resource
    type: docker-image
    source:
      repository: trivigy/discord-resource
resources:
  - name: discord
    type: discord-resource
    check_every: 999999h
    source:
      token: ((discord-token))
  - name: jfrog-artifactory
    type: artifactory
    source:
      endpoint: http://51.75.71.87:8081/artifactory
      repository: "/java-develop/photobox"
      regex: "photobox-(?<version>.*).jar"
      username: ci
      password: ((artifactory-secret))
      skip_ssl_verification: true
  - name: git-src
    type: git
    source:
      uri: git@github.com:dennispidun/photobox.git
      branch: master
      private_key: ((git-private-key))
jobs:
  - name: build-and-test
    plan:
      - get: git-src
        trigger: true
      - task: build
        privileged: true
        file: git-src/ci/tasks/build-and-test.yml
      - put: jfrog-artifactory
        params: { file: git-src/build/libs/photobox-*.jar }
      - put: discord
        params:
          channel: "((discord-channel-id))"
          color: 6076508
          title: PhotoBox Deployment Status
          message: |
            Success!!!